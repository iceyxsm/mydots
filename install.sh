#!/bin/bash\n\n# Request sudo access FIRST (before anything else)\nif ! sudo -v 2>/dev/null; then\n    echo "[ERROR] Sudo access required. Please run: sudo ./install.sh"\n    exit 1\nfi\n\n# Keep sudo alive in background\n(while true; do sudo -n true; sleep 60; done 2>/dev/null &)\nSUDO_PID=$!\ntrap "kill $SUDO_PID 2>/dev/null" EXIT\n\n# Colors - All green theme\nGREEN='\033[0;32m'\nCYAN='\033[0;32m'\nPURPLE='\033[0;32m'\nPINK='\033[0;32m'\nYELLOW='\033[0;32m'\nRED='\033[0;32m'\nNC='\033[0m'\n\n# Default mode\nMODE="full"\n\n# Parse arguments\nfor arg in "$@"; do\n    case $arg in\n        --finstall)\n            MODE="fresh"\n            shift\n            ;;\n        -finstall)\n            MODE="full"\n            shift\n            ;;\n        -minstall)\n            MODE="minimal"\n            shift\n            ;;\n        -h|--help)\n            echo "Cyberpunk Theme Installer"\n            echo "Made by iceyxsm"\n            echo ""\n            echo "Usage: ./install.sh [OPTION]"\n            echo ""\n            echo "Options:"\n            echo "  --finstall    FRESH install - DELETES all configs and packages"\n            echo "                (keeps: git, pacman, yay, base system)"\n            echo ""\n            echo "  -finstall     FULL install - Maintains files and apps (DEFAULT)"\n            echo "                Backs up existing configs, installs all packages"\n            echo ""\n            echo "  -minstall     MINIMAL install - Maintains existing packages"\n            echo "                Only installs missing packages, preserves configs"\n            echo ""\n            echo "Examples:"\n            echo "  ./install.sh --finstall    # Nuclear option - start fresh"\n            echo "  ./install.sh -finstall     # Standard install (default)"\n            echo "  ./install.sh -minstall     # Just add missing stuff"\n            exit 0\n            ;;\n    esac\ndone\n\necho -e "${GREEN}========================================${NC}"\necho -e "${GREEN}    Cyberpunk Theme Installer${NC}"\necho -e "${GREEN}       Made by iceyxsm${NC}"\necho -e "${GREEN}       Mode: ${MODE}${NC}"\necho -e "${GREEN}========================================${NC}"\necho ""\n\n# Check if running as root (don't allow)\nif [ "$EUID" -eq 0 ]; then \n    echo -e "${GREEN}[!] Please do not run this script as root${NC}"\n    exit 1\nfi\n\n# FRESH INSTALL MODE - NUCLEAR OPTION\nif [ "$MODE" = "fresh" ]; then\n    echo -e "${GREEN}========================================${NC}"\n    echo -e "${GREEN}  WARNING: FRESH INSTALL MODE${NC}"\n    echo -e "${GREEN}  This will DELETE all configs and packages!${NC}"\n    echo -e "${GREEN}========================================${NC}"\n    echo ""\n    echo -e "${GREEN}This will:${NC}"\n    echo "  - Remove all packages except: base, git, pacman, yay"\n    echo "  - Delete all dotfiles in ~/.config/"\n    echo "  - Delete wallpapers and themes"\n    echo "  - Keep: /home files (Documents, Downloads, etc.)"\n    echo ""\n    read -p "Are you sure? Type 'NUKE' to continue: " confirm\n    if [ "$confirm" != "NUKE" ]; then\n        echo -e "${GREEN}Aborted.${NC}"\n        exit 0\n    fi\n    \n    echo -e "${GREEN}[*] FRESH INSTALL: Removing packages...${NC}"\n    \n    # Get list of explicitly installed packages (excluding base and essential)\n    echo -e "  ${GREEN}Analyzing installed packages...${NC}"\n    \n    # Create list of packages to keep\n    KEEP_PKGS="base base-devel linux linux-firmware pacman git curl wget yay"\n    \n    # Remove all packages not in keep list\n    echo -e "  ${GREEN}Removing non-essential packages...${NC}"\n    pacman -Qeq | while read pkg; do\n        if ! echo "$KEEP_PKGS" | grep -qw "$pkg"; then\n            echo -e "  ${GREEN}Removing: $pkg${NC}"\n            sudo pacman -Rns --noconfirm "$pkg" 2>/dev/null || true\n        fi\n    done\n    \n    echo -e "${GREEN}[*] FRESH INSTALL: Cleaning configs...${NC}"\n    # Remove all .config except essential\n    for dir in ~/.config/*; do\n        [ -d "$dir" ] || continue\n        dir_name=$(basename "$dir")\n        echo -e "  ${GREEN}Removing: ~/.config/$dir_name${NC}"\n        rm -rf "$dir"\n    done\n    \n    # Clean other common locations\n    rm -rf ~/.local/share/{applications,flatpak} 2>/dev/null || true\n    rm -rf ~/.themes ~/.icons 2>/dev/null || true\n    \n    echo -e "${GREEN}[OK] System cleaned. Installing fresh...${NC}"\n    echo ""\nfi\n\n# Check for multilib support (required for lib32 packages)\necho -e "${GREEN}[*] Checking system configuration...${NC}"\nif ! grep -q "^\[multilib\]" /etc/pacman.conf; then\n    echo -e "  ${GREEN}[WARN] Multilib not enabled - required for 32-bit libraries${NC}"\n    echo -e "  ${GREEN}[*] Enabling multilib...${NC}"\n    sudo sed -i '/#\[multilib\]/,/#Include = \/etc\/pacman.d\/mirrorlist/s/#\[multilib\]/[multilib]/' /etc/pacman.conf\n    sudo sed -i '/^\[multilib\]$/,/^#Include = \/etc\/pacman.d\/mirrorlist$/s/^#Include = \/etc\/pacman.d\/mirrorlist$/Include = \/etc\/pacman.d\/mirrorlist/' /etc/pacman.conf\n    sudo pacman -Syu --noconfirm\n    echo -e "  ${GREEN}[OK] Multilib enabled${NC}"\nfi\n\n# Check for base-devel (required for makepkg/AUR)\nif ! pacman -Qg base-devel &> /dev/null; then\n    echo -e "  ${GREEN}[*] Installing base-devel (required for AUR)...${NC}"\n    sudo pacman -S --needed --noconfirm base-devel\n    echo -e "  ${GREEN}[OK] base-devel installed${NC}"\nfi\n\n# Backup existing configs (skip for minimal mode, always do for fresh)\nif [ "$MODE" != "minimal" ]; then\n    backup_dir="$HOME/.config_backup_$(date +%Y%m%d_%H%M%S)"\n    mkdir -p "$backup_dir"\n    \n    echo -e "${GREEN}[*] Backing up existing configs...${NC}"\n    for dir in hypr waybar kitty btop neofetch mako; do\n        if [ -d "$HOME/.config/$dir" ]; then\n            mv "$HOME/.config/$dir" "$backup_dir/"\n            echo -e "  ${GREEN}[OK] Backed up $dir${NC}"\n        fi\n    done\nfi\n\n# Create config directories\necho -e "${GREEN}[*] Creating config directories...${NC}"\nmkdir -p ~/.config/{hypr,waybar,kitty,btop/themes,neofetch,mako}\nmkdir -p ~/.config/hypr/wallpapers/{live-wallpapers,dark-theme,light-theme}\nmkdir -p ~/Pictures\n\n# Copy local wallpapers FIRST (but DON'T overwrite user files)\necho -e "${GREEN}[*] Checking local wallpapers...${NC}"\n\n# Only copy dark-theme wallpapers if folder is empty\nif [ -d ".config/hypr/wallpapers/dark-theme" ]; then\n    DARK_COUNT=$(ls -1 ~/.config/hypr/wallpapers/dark-theme/ 2>/dev/null | wc -l)\n    if [ "$DARK_COUNT" -eq 0 ]; then\n        # Folder is empty, copy defaults\n        cp -r .config/hypr/wallpapers/dark-theme/* ~/.config/hypr/wallpapers/dark-theme/ 2>/dev/null\n        echo -e "  ${GREEN}[OK] Default dark theme wallpapers copied${NC}"\n    else\n        echo -e "  ${GREEN}[OK] User dark theme wallpapers kept ($DARK_COUNT files)${NC}"\n    fi\nfi\n\n# Only copy light-theme wallpapers if folder is empty\nif [ -d ".config/hypr/wallpapers/light-theme" ]; then\n    LIGHT_COUNT=$(ls -1 ~/.config/hypr/wallpapers/light-theme/ 2>/dev/null | wc -l)\n    if [ "$LIGHT_COUNT" -eq 0 ]; then\n        cp -r .config/hypr/wallpapers/light-theme/* ~/.config/hypr/wallpapers/light-theme/ 2>/dev/null\n        echo -e "  ${GREEN}[OK] Default light theme wallpapers copied${NC}"\n    else\n        echo -e "  ${GREEN}[OK] User light theme wallpapers kept ($LIGHT_COUNT files)${NC}"\n    fi\nfi\n\n# Update system first (always do this)\necho -e "${GREEN}[*] Updating system...${NC}"\nsudo pacman -Syu --noconfirm || {\n    echo -e "${GREEN}[!] System update failed${NC}"\n    exit 1\n}\n\n# Function to install package (respects minimal mode)\ninstall_pkg() {\n    local pkg="$1"\n    local required="${2:-0}"\n    \n    if [ "$MODE" = "minimal" ] && pacman -Qi "$pkg" &> /dev/null; then\n        echo -e "  ${GREEN}[OK] $pkg already installed (skipping in minimal mode)${NC}"\n        return 0\n    fi\n    \n    if ! pacman -Qi "$pkg" &> /dev/null; then\n        echo -e "  ${GREEN}Installing $pkg...${NC}"\n        sudo pacman -S --needed --noconfirm "$pkg" || {\n            if [ "$required" = "1" ]; then\n                echo -e "  ${GREEN}[FAIL] Required package $pkg failed${NC}"\n                return 1\n            else\n                echo -e "  ${GREEN}[WARN] Failed to install $pkg, continuing...${NC}"\n            fi\n        }\n    else\n        echo -e "  ${GREEN}[OK] $pkg already installed${NC}"\n    fi\n}\n\n# Install base packages for Hyprland\necho -e "${GREEN}[*] Installing base Hyprland packages...${NC}"\nBASE_PACKAGES=(\n    "hyprland"\n    "hyprpaper"\n    "hyprlock"\n    "hypridle"\n    "waybar"\n    "kitty"\n    "wofi"\n    "mako"\n    "grim"\n    "slurp"\n    "wl-clipboard"\n    "xdg-desktop-portal-hyprland"\n    "qt5-wayland"\n    "qt6-wayland"\n    "qt6-declarative"  # Required for SDDM QML themes\n    "polkit-kde-agent"\n    "sddm"\n    "mpv"  # For live wallpapers\n    "qt6-multimedia-ffmpeg"  # For SDDM video wallpapers\n    "jq"  # For scripts that parse hyprctl JSON output\n)\n\nfor pkg in "${BASE_PACKAGES[@]}"; do\n    install_pkg "$pkg" 1\ndone\n\n# Detect GPU and install only required drivers\necho -e "${GREEN}[*] Detecting GPU...${NC}"\n\nHAS_NVIDIA=false\nHAS_INTEL=false\nHAS_AMD=false\nHAS_VMWARE=false\n\n# Check for VMware/VirtualBox\nif lspci -nn | grep -i 'vga\|3d\|display' | grep -i vmware &> /dev/null; then\n    HAS_VMWARE=true\n    echo -e "  ${GREEN}[OK] VMware SVGA detected (Virtual Machine)${NC}"\n    echo -e "  ${GREEN}[WARN] Running in VM - software rendering will be used${NC}"\nfi\n\n# Check for NVIDIA\nif lspci -nn | grep -i 'vga\|3d\|display' | grep -i nvidia &> /dev/null; then\n    HAS_NVIDIA=true\n    echo -e "  ${GREEN}[OK] NVIDIA GPU detected${NC}"\nfi\n\n# Check for Intel\nif lspci -nn | grep -i 'vga\|3d\|display' | grep -i intel &> /dev/null; then\n    HAS_INTEL=true\n    echo -e "  ${GREEN}[OK] Intel GPU detected${NC}"\nfi\n\n# Check for AMD\nif lspci -nn | grep -i 'vga\|3d\|display' | grep -i amd &> /dev/null || \\n   lspci -nn | grep -i 'vga\|3d\|display' | grep -i advanced &> /dev/null; then\n    HAS_AMD=true\n    echo -e "  ${GREEN}[OK] AMD GPU detected${NC}"\nfi\n\n# Install base mesa (always needed)\necho -e "${GREEN}[*] Installing GPU drivers...${NC}"\ninstall_pkg "mesa"\ninstall_pkg "lib32-mesa"\n\n# Install Intel drivers only if Intel GPU detected\nif [ "$HAS_INTEL" = true ]; then\n    echo -e "  ${GREEN}Installing Intel drivers...${NC}"\n    install_pkg "vulkan-intel"\nfi\n\n# Install AMD drivers only if AMD GPU detected\nif [ "$HAS_AMD" = true ]; then\n    echo -e "  ${GREEN}Installing AMD drivers...${NC}"\n    install_pkg "vulkan-radeon"\nfi\n\n# Always install ICD loader\ninstall_pkg "vulkan-icd-loader"\ninstall_pkg "lib32-vulkan-icd-loader"\n\n# Check for NVIDIA GPU and auto-install appropriate driver\nif [ "$HAS_NVIDIA" = true ]; then\n    echo -e "${GREEN}[*] Installing NVIDIA drivers...${NC}"\n    \n    # Extract PCI ID\n    PCI_ID=$(lspci -nn | grep -i 'vga\|3d\|display' | grep -i nvidia | grep -oP '\[10de:\K[0-9a-f]+' | head -n1 | tr '[:lower:]' '[:upper:]')\n    \n    if [ -n "$PCI_ID" ]; then\n        echo -e "  ${GREEN}PCI ID: ${PCI_ID}${NC}"\n        \n        # Determine driver based on PCI ID\n        case "$PCI_ID" in\n            # Blackwell RTX 5000\n            2B85|2B87|2C05|2C07|2D05|2D07)\n                DRIVER="nvidia-open-dkms"\n                DESC="RTX 5000 series"\n                ;;\n            # Ada Lovelace RTX 4000\n            2684|2685|2686|2687|2688|2689|26B0|26B1|26B2|26B3|26B5|26B6|2704|2705|2730|2750|2780|2781|2782|2783|2786|2787|27A0|27B0|27B1|27B2|27B3|27B6|27B7|27B8|27B9|27BA|27BB|27E0)\n                DRIVER="nvidia-open-dkms"\n                DESC="RTX 4000 series"\n                ;;\n            # Ampere RTX 3000\n            2204|2206|2207|2208|220A|2216|222F|2230|2231|2232|2233|2235|2236|2237|2414|2420|2438|2482|2484|2486|2487|2488|2489|24B0|24B1|24B6|24B7|24B8|24B9|24BA|24C9|24DC|24DD|24E0|24FA|2503|2504|2507|2508|2520|2523|2531|2544|2560|2571|2582|2583|2584|25B0|25B2|25B6|25B8|25E0|25E2|25E5|25F0|25F8|25F9|25FA)\n                DRIVER="nvidia-dkms"\n                DESC="RTX 3000 series"\n                ;;\n            # Turing RTX 2000/GTX 1600\n            1E02|1E04|1E07|1E09|1E30|1E36|1E78|1E81|1E82|1E84|1E87|1E90|1EB0|1EB1|1EB5|1EB6|1EC2|1EC7|1ED0|1ED1|1ED3|1EDF|1F02|1F03|1F06|1F07|1F08|1F10|1F11|1F12|1F14|1F15|1F36|1F42|1F47|1F54|1F76|1F82|1F83|1F91|1F95|1F96|1F97|1F98|1F99|1F9C|1F9D|1FA0|1FB0|1FB1|1FB2|1FB6|1FB7|1FB8|1FB9|1FBC|1FDD|1FF0|1FF2|1FF9|2182|2184|2187|2188|2189|21C4|21D1)\n                DRIVER="nvidia-dkms"\n                DESC="RTX 2000/GTX 1600 series"\n                ;;\n            # Pascal GTX 1000\n            1582|15F0|15F7|15F8|15F9|1617|1618|1619|161A|179C|17C2|17C8|1B00|1B02|1B06|1B30|1B34|1B38|1B80|1B81|1B82|1B83|1B84|1B87|1BA0|1BA1|1BA2|1BB0|1BB1|1BB3|1BB4|1BB5|1BB6|1BB7|1BB8|1BB9|1BC7|1BE0|1BE1|1C02|1C03|1C07|1C09|1C20|1C21|1C22|1C30|1C31|1C60|1C61|1C62|1C81|1C82|1C83|1C8C|1C8D|1C8F|1CB1|1CB2|1CB3|1CB6|1D01|1D02|1D10|1D11|1D12|1D13|1D16|1D33|1D34|1D35|1D36|1D52|1D71|1D81|1DB1|1DB3|1DB4|1DB5|1DB6|1DB7|1DB8)\n                DRIVER="nvidia-dkms"\n                DESC="GTX 1000 series"\n                ;;\n            # Maxwell GTX 900/750\n            13C0|13C1|13C2|13C3|13D7|13D8|13D9|13DA|13F0|13F1|13F2|13F3|13F8|13F9|13FA|13FB|1401|1402|1406|1407|1427|1430|1431|1436|1613)\n                DRIVER="nvidia-dkms"\n                DESC="GTX 900 series"\n                ;;\n            # Kepler - LEGACY (AUR)\n            0FC0|0FC1|0FC2|0FC6|0FC8|0FC9|0FCD|0FCE|0FD1|0FD2|0FD3|0FD4|0FD5|0FD8|0FD9|0FDF|0FE0|0FE1|0FE2|0FE3|0FE4|1001|1004|1005|1007|1008|100A|100C|1021|1022|1023|1024|1026|1027|1028|1029|103A|103C|1180|1183|1184|1185|1187|1188|1189|118A|118E|118F|1193|1194|1195|1198|1199|119A|119D|119E|119F|11A0|11A1|11A2|11A3|11A7|11B4|11B6|11B7|11B8|11BA|11BC|11BD|11BE|11BF|11C0|11C2|11C3|11C4|11C5|11C6|11C8|11CB|11E0|11E1|11E2|11E3|11E7|11FA|11FC|1280|1281|1282|1284|1286|1287|1288|1289|128B|1290|1291|1292|1293|1295|1296|1298|1299|12B9|12BA)\n                DRIVER="nvidia-470xx-dkms"\n                DESC="GTX 600/700 series (LEGACY)"\n                AUR=1\n                ;;\n            # Fermi - VERY LEGACY (AUR)\n            06C0|06C4|06CA|06CD|06D1|06D2|06D8|06D9|06DA|06DC|06DD|06DE|06DF|0DC0|0DC4|0DC5|0DC6|0DCD|0DCE|0DD1|0DD2|0DD6|0DE0|0DE1|0DE2|0DE3|0DE4|0DE5|0DE7|0DE8|0DE9|0DEA|0DEB|0DEC|0DED|0DEE|0DEF|0DF0|0DF1|0DF2|0DF3|0DF4|0DF5|0DF6|0DF7|0DF8|0DF9|0DFA|0DFC|0E22|0E23|0E24|0E30|0E31|0E3A|0E3B|0F00|0F01|0F02|0F03|0E3C|0E3D|0E3E|0FCD)\n                DRIVER="nvidia-390xx-dkms"\n                DESC="GTX 400/500 series (LEGACY)"\n                AUR=1\n                ;;\n            # Unknown - default to nvidia-dkms\n            *)\n                DRIVER="nvidia-dkms"\n                DESC="Unknown NVIDIA GPU"\n                ;;\n        esac\n        \n        echo -e "  ${GREEN}[OK] Detected: ${DESC}${NC}"\n        echo -e "  ${GREEN}[*] Installing ${DRIVER}...${NC}"\n        \n        # Check if already installed (minimal mode)\n        if [ "$MODE" = "minimal" ] && pacman -Qi "$DRIVER" &> /dev/null; then\n            echo -e "  ${GREEN}[OK] ${DRIVER} already installed (minimal mode)${NC}"\n        else\n            # Blacklist nouveau\n            if lsmod | grep -q nouveau 2>/dev/null; then\n                echo -e "  ${GREEN}[*] Blacklisting nouveau...${NC}"\n                echo "blacklist nouveau" | sudo tee /etc/modprobe.d/blacklist-nouveau.conf > /dev/null\n                echo "options nouveau modeset=0" | sudo tee -a /etc/modprobe.d/blacklist-nouveau.conf > /dev/null\n            fi\n            \n            # Install driver\n            if [ "$AUR" = "1" ]; then\n                echo -e "  ${GREEN}[WARN] Legacy GPU - requires AUR package${NC}"\n                if command -v yay &> /dev/null; then\n                    yay -S --noconfirm "$DRIVER" 2>/dev/null || echo -e "  ${GREEN}[WARN] Failed to install $DRIVER${NC}"\n                else\n                    echo -e "  ${GREEN}[WARN] yay not available, skipping NVIDIA driver${NC}"\n                fi\n            else\n                sudo pacman -S --needed --noconfirm "$DRIVER" nvidia-utils lib32-nvidia-utils 2>/dev/null || echo -e "  ${GREEN}[WARN] Failed to install NVIDIA driver${NC}"\n            fi\n            \n            # Configure if installed\n            if pacman -Qi "$DRIVER" &> /dev/null 2>&1 || [ "$DRIVER" = "nvidia-dkms" -a -d "/usr/lib/nvidia" ]; then\n                echo -e "  ${GREEN}[*] Configuring NVIDIA...${NC}"\n                # Early module loading\n                if ! grep -q "nvidia" /etc/mkinitcpio.conf 2>/dev/null; then\n                    sudo sed -i 's/MODULES=()/MODULES=(nvidia nvidia_modeset nvidia_uvm nvidia_drm)/' /etc/mkinitcpio.conf\n                fi\n                # DRM KMS\n                if [ ! -f "/etc/modprobe.d/nvidia.conf" ]; then\n                    echo "options nvidia_drm modeset=1" | sudo tee /etc/modprobe.d/nvidia.conf > /dev/null\n                fi\n                sudo mkinitcpio -P 2>/dev/null || true\n                echo -e "  ${GREEN}[OK] NVIDIA driver installed and configured${NC}"\n            fi\n        fi\n    else\n        echo -e "  ${GREEN}[WARN] Could not detect PCI ID, skipping NVIDIA driver${NC}"\n    fi\nfi\n\n# Install PipeWire audio stack\necho -e "${GREEN}[*] Installing PipeWire audio stack...${NC}"\nAUDIO_PACKAGES=(\n    "pipewire"\n    "pipewire-audio"\n    "pipewire-pulse"\n    "pipewire-alsa"\n    "wireplumber"\n)\n\nfor pkg in "${AUDIO_PACKAGES[@]}"; do\n    install_pkg "$pkg"\ndone\n\n# Install additional tools\necho -e "${GREEN}[*] Installing additional tools...${NC}"\nTOOLS=(\n    "btop"\n    "thunar"\n    "gvfs"\n    "gvfs-mtp"\n    "file-roller"\n    "pavucontrol"\n    "network-manager-applet"\n    "wireless_tools"\n    "iw"\n    "iwd"\n    "linux-firmware"\n    "wireless-regdb"\n    "bluez"\n    "bluez-utils"\n    "blueman"\n    "brightnessctl"\n    "playerctl"\n    "python-pip"\n    "git"\n    "wget"\n    "curl"\n)\n\nfor pkg in "${TOOLS[@]}"; do\n    install_pkg "$pkg"\ndone\n\n# Install fonts\necho -e "${GREEN}[*] Installing fonts...${NC}"\nREPO_FONTS=(\n    "ttf-font-awesome"\n    "noto-fonts"\n    "noto-fonts-emoji"\n)\n\nfor font in "${REPO_FONTS[@]}"; do\n    install_pkg "$font"\ndone\n\n# Enable services\necho -e "${GREEN}[*] Enabling system services...${NC}"\nsudo systemctl enable --now bluetooth.service 2>/dev/null || echo -e "  ${GREEN}[WARN] Bluetooth service failed${NC}"\nsudo systemctl enable --now NetworkManager.service 2>/dev/null || echo -e "  ${GREEN}[WARN] NetworkManager failed${NC}"\n\n# Enable SDDM display manager\necho -e "${GREEN}[*] Enabling SDDM display manager...${NC}"\nsudo systemctl enable sddm.service 2>/dev/null || echo -e "  ${GREEN}[WARN] SDDM enable failed${NC}"\n\n# Clear SDDM cache to force theme refresh\nsudo rm -rf /var/lib/sddm/.cache/ 2>/dev/null || true\n\n# Restart SDDM if it's already running (to apply new theme)\nif systemctl is-active --quiet sddm.service 2>/dev/null; then\n    echo -e "  ${GREEN}[*] Restarting SDDM to apply new theme...${NC}"\n    sudo systemctl restart sddm.service 2>/dev/null || echo -e "  ${GREEN}[WARN] SDDM restart failed (may need manual restart)${NC}"\nfi\n\necho -e "  ${GREEN}[OK] SDDM configured${NC}"\n\n# Verify hyprland.desktop exists\nif [ ! -f "/usr/share/wayland-sessions/hyprland.desktop" ]; then\n    echo -e "${GREEN}[WARN] hyprland.desktop not found, creating...${NC}"\n    sudo mkdir -p /usr/share/wayland-sessions\n    sudo tee /usr/share/wayland-sessions/hyprland.desktop > /dev/null << 'EOF'\n[Desktop Entry]\nName=Hyprland\nComment=An intelligent dynamic tiling Wayland compositor\nExec=/usr/bin/Hyprland\nType=Application\nDesktopNames=Hyprland\nXDG_CURRENT_DESKTOP=Hyprland\nNoDisplay=false\nEOF\n    sudo chmod 644 /usr/share/wayland-sessions/hyprland.desktop\n    echo -e "  ${GREEN}[OK] hyprland.desktop created${NC}"\nfi\n\n# Create SDDM session fix - THIS IS CRITICAL FOR LOGIN LOOP\necho -e "${GREEN}[*] Creating SDDM session fix...${NC}"\nsudo mkdir -p /etc/sddm.conf.d\n\n# Remove old conflicting configs\nsudo rm -f /etc/sddm.conf.d/hyprland.conf 2>/dev/null || true\nsudo rm -f /etc/sddm.conf.d/10-wayland.conf 2>/dev/null || true\n\n# Remove old theme if it exists (to force fresh install)\nif [ -d "/usr/share/sddm/themes/sddm-astronaut-theme" ]; then\n    echo -e "  ${GREEN}[*] Removing old astronaut theme for fresh install...${NC}"\n    sudo rm -rf /usr/share/sddm/themes/sddm-astronaut-theme\nfi\n\n# Create proper SDDM config in conf.d\nsudo tee /etc/sddm.conf.d/99-hyprland.conf > /dev/null << 'EOF'\n[General]\nDisplayServer=x11\nGreeterEnvironment=QT_QPA_PLATFORM=xcb\nDefaultSession=hyprland.desktop\n\n[Theme]\nCurrent=sddm-astronaut-theme\nEOF\n\n# ALSO create/update /etc/sddm.conf directly (some systems need this)\nSDDM_CONF="/etc/sddm.conf"\nif [ -f "$SDDM_CONF" ]; then\n    echo -e "  ${GREEN}[*] Backing up existing /etc/sddm.conf...${NC}"\n    sudo cp "$SDDM_CONF" "$SDDM_CONF.bak.$(date +%Y%m%d%H%M%S)" 2>/dev/null || true\nfi\n\n# Create /etc/sddm.conf with theme settings\nsudo tee "$SDDM_CONF" > /dev/null << 'EOF'\n[General]\nDisplayServer=x11\nGreeterEnvironment=QT_QPA_PLATFORM=xcb\nDefaultSession=hyprland.desktop\nInputMethod=qtvirtualkeyboard\n\n[Theme]\nCurrent=sddm-astronaut-theme\nEOF\n\necho -e "  ${GREEN}[OK] SDDM config created (using X11 backend for stability)${NC}"\n\n# Create Hyprland environment file with GPU fixes\necho -e "${GREEN}[*] Creating Hyprland environment config...${NC}"\nmkdir -p ~/.config/hypr\nsudo mkdir -p /etc/environment.d\n\n# Detect if running in VM for special config\nif lspci -nn | grep -i vmware &> /dev/null || lspci -nn | grep -i virtualbox &> /dev/null; then\n    VM_FIXES="# Virtual Machine fixes (VMware/VirtualBox)\nWLR_RENDERER_ALLOW_SOFTWARE=1\nWLR_NO_HARDWARE_CURSORS=1\nWLR_BACKEND=wayland"\n    echo -e "  ${GREEN}[OK] Applied VM-specific fixes${NC}"\nelse\n    VM_FIXES="# NVIDIA fixes (if applicable)\nWLR_NO_HARDWARE_CURSORS=1\nWLR_RENDERER_ALLOW_SOFTWARE=1\nWLR_DRM_NO_ATOMIC=1\nWLR_DRM_NO_MODIFIERS=1"\nfi\n\n# For user\ncat > ~/.config/hypr/environment.conf << EOF\n# GPU/Display fixes\n$VM_FIXES\n\n# Session type\nXDG_SESSION_TYPE=wayland\nXDG_CURRENT_DESKTOP=Hyprland\n\n# QT/Wayland\nQT_QPA_PLATFORM=wayland\nQT_QPA_PLATFORMTHEME=qt5ct\n\n# SDL\nSDL_VIDEODRIVER=wayland\n\n# Mozilla\nMOZ_ENABLE_WAYLAND=1\n\n# For NVIDIA cards\nif [ -d /proc/driver/nvidia ]; then\n    export __GLX_VENDOR_LIBRARY_NAME=nvidia\n    export GBM_BACKEND=nvidia-drm\n    export __GL_GSYNC_ALLOWED=0\n    export __GL_VRR_ALLOWED=0\nfi\nEOF\n\n# For system\nsudo tee /etc/environment.d/99-hyprland.conf > /dev/null << 'EOF'\nWLR_NO_HARDWARE_CURSORS=1\nWLR_RENDERER_ALLOW_SOFTWARE=1\nWLR_DRM_NO_ATOMIC=1\nWLR_DRM_NO_MODIFIERS=1\nXDG_SESSION_TYPE=wayland\nQT_QPA_PLATFORM=wayland\nEOF\n\necho -e "  ${GREEN}[OK] Environment config created${NC}"\n\n# Configure NetworkManager WiFi backend\necho -e "${GREEN}[*] Configuring NetworkManager WiFi backend...${NC}"\nsudo mkdir -p /etc/NetworkManager/NetworkManager.conf.d\necho -e "[device]\nwifi.backend=iwd" | sudo tee /etc/NetworkManager/NetworkManager.conf.d/wifi-backend.conf > /dev/null\necho -e "  ${GREEN}[OK] Using iwd for WiFi (faster connection)${NC}"\n\n# Install neofetch (now AUR only) - do this early so it works in all modes\necho -e "${GREEN}[*] Installing neofetch (AUR)...${NC}"\nif ! command -v neofetch &> /dev/null; then\n    if ! command -v yay &> /dev/null; then\n        echo -e "  ${GREEN}Installing yay first...${NC}"\n        YAY_TEMP="$(mktemp -d)"\n        git clone https://aur.archlinux.org/yay.git "$YAY_TEMP" 2>/dev/null && \\n            (cd "$YAY_TEMP" && makepkg -si --noconfirm 2>/dev/null) || \\n            echo -e "  ${GREEN}[WARN] Failed to install yay, skipping neofetch${NC}"\n        rm -rf "$YAY_TEMP"\n    fi\n    if command -v yay &> /dev/null; then\n        yay -S --noconfirm neofetch 2>/dev/null && \\n            echo -e "  ${GREEN}[OK] neofetch installed${NC}" || \\n            echo -e "  ${GREEN}[WARN] Failed to install neofetch${NC}"\n    fi\nelse\n    echo -e "  ${GREEN}[OK] neofetch already installed${NC}"\nfi\n\n# Install yay AUR helper (if not in minimal mode or yay missing)\nif [ "$MODE" != "minimal" ] || ! command -v yay &> /dev/null; then\n    echo -e "${GREEN}[*] Installing yay AUR helper...${NC}"\n    if ! command -v yay &> /dev/null; then\n        YAY_BUILD_DIR="$(mktemp -d)"\n        git clone https://aur.archlinux.org/yay.git "$YAY_BUILD_DIR" || {\n            echo -e "${GREEN}[WARN] Failed to clone yay, continuing without AUR packages...${NC}"\n            YAY_FAILED=1\n        }\n        if [ -z "$YAY_FAILED" ]; then\n            (cd "$YAY_BUILD_DIR" && makepkg -si --noconfirm) || {\n                echo -e "${GREEN}[WARN] Failed to build yay, continuing without AUR packages...${NC}"\n                YAY_FAILED=1\n            }\n        fi\n        rm -rf "$YAY_BUILD_DIR"\n    else\n        echo -e "  ${GREEN}[OK] yay already installed${NC}"\n    fi\n    \n    # Install AUR packages if yay available\n    if [ -z "$YAY_FAILED" ] && command -v yay &> /dev/null; then\n        echo -e "  ${GREEN}Installing nerd-fonts-jetbrains-mono from AUR...${NC}"\n        yay -S --noconfirm nerd-fonts-jetbrains-mono 2>/dev/null || echo -e "  ${GREEN}[WARN] Failed to install JetBrains Nerd Font${NC}"\n        \n        echo -e "  ${GREEN}Installing cliphist from AUR...${NC}"\n        yay -S --noconfirm cliphist 2>/dev/null || echo -e "  ${GREEN}[WARN] Failed to install cliphist${NC}"\n        \n        echo -e "${GREEN}[*] Installing SDDM Astronaut theme (AUR)...${NC}"\n        # Force reinstall to ensure fresh theme\n        yay -S --noconfirm --rebuildtree sddm-astronaut-theme 2>/dev/null || echo -e "  ${GREEN}[WARN] sddm-astronaut-theme install failed${NC}"\n        \n        echo -e "${GREEN}[*] Installing mpvpaper for live wallpapers (AUR)...${NC}"\n        yay -S --noconfirm mpvpaper 2>/dev/null || echo -e "  ${GREEN}[WARN] mpvpaper install failed - live wallpapers won't work${NC}"\n    fi\nfi\n\n# Enable PipeWire services\necho -e "${GREEN}[*] Enabling PipeWire audio services...${NC}"\nsystemctl --user enable pipewire.service 2>/dev/null || true\nsystemctl --user enable pipewire-pulse.service 2>/dev/null || true\nsystemctl --user enable wireplumber.service 2>/dev/null || true\necho -e "  ${GREEN}[OK] PipeWire services enabled for user${NC}"\n\n# Configure SDDM theme (only if astronaut theme was installed)\nif [ -d "/usr/share/sddm/themes/sddm-astronaut-theme" ]; then\n    echo -e "${GREEN}[*] SDDM Astronaut theme installed${NC}"\n    # Verify theme config\n    if [ -f "/etc/sddm.conf.d/99-hyprland.conf" ]; then\n        echo -e "  ${GREEN}[OK] SDDM config verified${NC}"\n        cat /etc/sddm.conf.d/99-hyprland.conf | grep "Current=" | sed 's/^/    /'\n    fi\nelse\n    echo -e "  ${GREEN}[WARN] Astronaut theme not found, using default SDDM theme${NC}"\nfi\n\n# Install gdown for wallpaper downloads\nif [ "$MODE" != "minimal" ]; then\n    echo -e "${GREEN}[*] Installing gdown for wallpaper downloads...${NC}"\n    if ! command -v gdown &> /dev/null; then\n        # Install pipx first (recommended way on Arch)\n        install_pkg "python-pipx"\n        # Use pipx to install gdown in isolated environment\n        pipx install gdown 2>/dev/null || \\n            pip install --user --break-system-packages gdown 2>/dev/null || \\n            echo -e "  ${GREEN}[WARN] Failed to install gdown${NC}"\n        export PATH="$HOME/.local/bin:$PATH"\n    else\n        echo -e "  ${GREEN}[OK] gdown already installed${NC}"\n    fi\n    \n    # Download wallpapers from Google Drive (only if not already present)\n    if command -v gdown &> /dev/null; then\n        LIVE_DIR="$HOME/.config/hypr/wallpapers/live-wallpapers"\n        MARKER_FILE="$LIVE_DIR/.downloaded"\n        \n        # Check for image files specifically\n        if [ -d "$LIVE_DIR" ]; then\n            IMG_COUNT=$(find "$LIVE_DIR" -type f \( -iname "*.jpg" -o -iname "*.jpeg" -o -iname "*.png" -o -iname "*.gif" -o -iname "*.webp" \) 2>/dev/null | wc -l)\n        else\n            IMG_COUNT=0\n            mkdir -p "$LIVE_DIR"\n        fi\n        \n        echo -e "${GREEN}[*] Checking for existing wallpapers...${NC}"\n        echo -e "  ${GREEN}Found $IMG_COUNT image files${NC}"\n        \n        # Skip if we have images or marker file\n        if [ "$IMG_COUNT" -ge 2 ] || [ -f "$MARKER_FILE" ]; then\n            echo -e "${GREEN}[*] Live wallpapers already exist ($IMG_COUNT images), skipping download${NC}"\n            touch "$MARKER_FILE"  # Ensure marker exists\n        else\n            echo -e "${GREEN}[*] Downloading live wallpapers from Google Drive...${NC}"\n            echo -e "  ${GREEN}This may take a few minutes...${NC}"\n            GDRIVE_FOLDER="https://drive.google.com/drive/folders/1oS6aUxoW6DGoqzu_S3pVBlgicGPgIoYq"\n            \n            gdown --folder "$GDRIVE_FOLDER" -O "$LIVE_DIR" --remaining-ok --no-cookies 2>&1\n            \n            # Count downloaded images\n            NEW_COUNT=$(find "$LIVE_DIR" -type f \( -iname "*.jpg" -o -iname "*.jpeg" -o -iname "*.png" -o -iname "*.gif" -o -iname "*.webp" \) 2>/dev/null | wc -l)\n            echo -e "  ${GREEN}Downloaded $NEW_COUNT image files${NC}"\n            \n            if [ "$NEW_COUNT" -gt 0 ]; then\n                echo -e "  ${GREEN}[OK] Downloaded $NEW_COUNT wallpapers!${NC}"\n                touch "$MARKER_FILE"\n            else\n                echo -e "  ${GREEN}[WARN] Download failed. Manual: $GDRIVE_FOLDER${NC}"\n            fi\n        fi\n    fi\nfi\n\n# Copy configs (skip for minimal mode if configs exist)\nif [ "$MODE" != "minimal" ]; then\n    echo -e "${GREEN}[*] Copying configuration files...${NC}"\n    if [ -d ".config/hypr" ]; then\n        # Check if running in VM\n        if lspci -nn | grep -i 'vga\|3d\|display' | grep -iE 'vmware|virtualbox' &> /dev/null; then\n            echo -e "  ${GREEN}[OK] Virtual Machine detected - using VM config${NC}"\n            # Copy VM-specific config as main config\n            if [ -f ".config/hypr/hyprland-vm.conf" ]; then\n                cp .config/hypr/hyprland-vm.conf ~/.config/hypr/hyprland.conf\n                echo -e "  ${GREEN}[OK] VM-optimized hyprland.conf installed${NC}"\n            fi\n        else\n            echo -e "  ${GREEN}[OK] Real hardware detected - using full config${NC}"\n            # Copy normal config\n            cp .config/hypr/hyprland.conf ~/.config/hypr/hyprland.conf 2>/dev/null || true\n        fi\n        # Copy other config files\n        cp .config/hypr/environment.conf ~/.config/hypr/ 2>/dev/null || true\n        cp .config/hypr/hyprlock.conf ~/.config/hypr/ 2>/dev/null || true\n        cp .config/hypr/hyprlock-video.conf ~/.config/hypr/ 2>/dev/null || true\n        cp .config/hypr/hypridle.conf ~/.config/hypr/ 2>/dev/null || true\n        \n        # Copy scripts\n        if [ -d ".config/hypr/scripts" ]; then\n            mkdir -p ~/.config/hypr/scripts\n            cp .config/hypr/scripts/*.sh ~/.config/hypr/scripts/ 2>/dev/null || true\n            chmod +x ~/.config/hypr/scripts/*.sh 2>/dev/null || true\n            echo -e "  ${GREEN}[OK] Hyprland scripts copied${NC}"\n        fi\n        \n        echo -e "  ${GREEN}[OK] Hyprland configs copied${NC}"\n    fi\n    if [ -d ".config/waybar" ]; then\n        cp -r .config/waybar/* ~/.config/waybar/ 2>/dev/null && echo -e "  ${GREEN}[OK] Waybar configs copied${NC}"\n    fi\n    if [ -d ".config/kitty" ]; then\n        cp -r .config/kitty/* ~/.config/kitty/ 2>/dev/null && echo -e "  ${GREEN}[OK] Kitty configs copied${NC}"\n    fi\n    if [ -d ".config/btop" ]; then\n        cp -r .config/btop/* ~/.config/btop/ 2>/dev/null && echo -e "  ${GREEN}[OK] btop configs copied${NC}"\n    fi\n    if [ -d ".config/neofetch" ]; then\n        cp -r .config/neofetch/* ~/.config/neofetch/ 2>/dev/null && echo -e "  ${GREEN}[OK] Neofetch configs copied${NC}"\n    fi\n    if [ -d ".config/mako" ]; then\n        cp -r .config/mako/* ~/.config/mako/ 2>/dev/null && echo -e "  ${GREEN}[OK] Mako notification config copied${NC}"\n    fi\n    \n    # Remove old hyprpaper.conf to ensure fresh config\n    rm -f ~/.config/hypr/hyprpaper.conf 2>/dev/null || true\n    \n    # Determine default wallpaper\n    echo -e "${GREEN}[*] Configuring wallpaper...${NC}"\n    \n    # Check for live wallpapers first\n    echo -e "  ${GREEN}Checking for live wallpapers...${NC}"\n    LIVE_DIR="$HOME/.config/hypr/wallpapers/live-wallpapers"\n    DARK_DIR="$HOME/.config/hypr/wallpapers/dark-theme"\n    \n    echo -e "    ${GREEN}LIVE_DIR = $LIVE_DIR${NC}"\n    echo -e "    ${GREEN}DARK_DIR = $DARK_DIR${NC}"\n    \n    # Debug: show what's in the folders\n    if [ -d "$LIVE_DIR" ]; then\n        LIVE_COUNT=$(ls -1 "$LIVE_DIR" 2>/dev/null | wc -l)\n        echo -e "    ${GREEN}Found $LIVE_COUNT files in live-wallpapers/${NC}"\n        ls -1 "$LIVE_DIR" 2>/dev/null | head -5\n    else\n        echo -e "    ${GREEN}live-wallpapers directory does NOT exist${NC}"\n    fi\n    if [ -d "$DARK_DIR" ]; then\n        DARK_COUNT=$(ls -1 "$DARK_DIR" 2>/dev/null | wc -l)\n        echo -e "    ${GREEN}Found $DARK_COUNT files in dark-theme/${NC}"\n    fi\n    \n    if [ -d "$LIVE_DIR" ] && [ "$(ls -A "$LIVE_DIR" 2>/dev/null)" ]; then\n        LIVE_WALL=$(ls "$LIVE_DIR" | head -n1)\n        DEFAULT_WALLPAPER="$LIVE_DIR/$LIVE_WALL"\n        echo -e "  ${GREEN}[OK] Using LIVE wallpaper: $LIVE_WALL${NC}"\n    # Then check for dark theme wallpapers\n    elif [ -f "$DARK_DIR/dark-wall1.jpg" ]; then\n        DEFAULT_WALLPAPER="$DARK_DIR/dark-wall1.jpg"\n        echo -e "  ${GREEN}[OK] Using DARK THEME wallpaper: dark-wall1.jpg${NC}"\n    # Last resort - check if any dark theme wallpaper exists\n    elif [ -d "$DARK_DIR" ] && [ "$(ls -A "$DARK_DIR" 2>/dev/null)" ]; then\n        DARK_WALL=$(ls "$DARK_DIR" | head -n1)\n        DEFAULT_WALLPAPER="$DARK_DIR/$DARK_WALL"\n        echo -e "  ${GREEN}[OK] Using DARK THEME wallpaper: $DARK_WALL${NC}"\n    else\n        echo -e "  ${GREEN}[WARN] No wallpapers found! Using solid color.${NC}"\n        DEFAULT_WALLPAPER=""\n    fi\n    \n    # Generate hyprpaper.conf\n    if [ -n "$DEFAULT_WALLPAPER" ] && [ -f "$DEFAULT_WALLPAPER" ]; then\n        cat > ~/.config/hypr/hyprpaper.conf << EOF\npreload = $DEFAULT_WALLPAPER\nwallpaper = ,$DEFAULT_WALLPAPER\nsplash = false\nipc = on\nEOF\n        echo -e "  ${GREEN}[OK] hyprpaper.conf created with:${NC}"\n        echo -e "    ${GREEN}$DEFAULT_WALLPAPER${NC}"\n        \n        # Update hyprlock.conf to use SAME wallpaper\n        if [ -f "$HOME/.config/hypr/hyprlock.conf" ]; then\n            echo -e "  ${GREEN}[*] Updating hyprlock.conf to match...${NC}"\n            sed -i "s|path = .*|path = $DEFAULT_WALLPAPER|" "$HOME/.config/hypr/hyprlock.conf" 2>/dev/null && \\n                echo -e "    ${GREEN}[OK] hyprlock.conf updated${NC}" || \\n                echo -e "    ${GREEN}[WARN] Could not update hyprlock.conf${NC}"\n        fi\n        \n        # Set SDDM wallpaper (with video support!)\n        if [ -d "/usr/share/sddm/themes/sddm-astronaut-theme" ]; then\n            echo -e "${GREEN}[*] Setting SDDM wallpaper...${NC}"\n            \n            # Check if we have video wallpapers\n            VIDEO_WALL=""\n            if [ -d "$LIVE_DIR" ]; then\n                VIDEO_WALL=$(find "$LIVE_DIR" -type f \( -iname "*.mp4" -o -iname "*.webm" \) 2>/dev/null | head -n1)\n            fi\n            \n            # Find the active theme config file\n            THEME_CONFIG="/usr/share/sddm/themes/sddm-astronaut-theme/Themes/astronaut.conf"\n            if [ ! -f "$THEME_CONFIG" ]; then\n                # Fallback to any .conf in Themes directory\n                THEME_CONFIG=$(find /usr/share/sddm/themes/sddm-astronaut-theme/Themes/ -name "*.conf" 2>/dev/null | head -n1)\n            fi\n            \n            # Create theme.conf.user for wallpaper override (astronaut theme supports this)\n            if [ -n "$VIDEO_WALL" ]; then\n                # Use VIDEO wallpaper for SDDM!\n                echo -e "  ${GREEN}[OK] Using VIDEO wallpaper for SDDM!${NC}"\n                sudo cp "$VIDEO_WALL" /usr/share/sddm/themes/sddm-astronaut-theme/background.mp4 2>/dev/null\n                sudo chmod 644 /usr/share/sddm/themes/sddm-astronaut-theme/background.mp4 2>/dev/null\n                \n                # Create theme.conf.user with video background\n                sudo tee /usr/share/sddm/themes/sddm-astronaut-theme/theme.conf.user > /dev/null << EOF\n[General]\nBackground="background.mp4"\nEOF\n                \n                # Also update the main theme config\n                if [ -f "$THEME_CONFIG" ]; then\n                    sudo sed -i 's|Background=.*|Background="background.mp4"|g' "$THEME_CONFIG" 2>/dev/null || true\n                fi\n                echo -e "  ${GREEN}[OK] SDDM video wallpaper set!${NC}"\n            else\n                # Fall back to static image\n                sudo cp "$DEFAULT_WALLPAPER" /usr/share/sddm/themes/sddm-astronaut-theme/background.jpg 2>/dev/null\n                sudo chmod 644 /usr/share/sddm/themes/sddm-astronaut-theme/background.jpg 2>/dev/null\n                \n                # Create theme.conf.user with image background\n                sudo tee /usr/share/sddm/themes/sddm-astronaut-theme/theme.conf.user > /dev/null << EOF\n[General]\nBackground="background.jpg"\nEOF\n                \n                # Also update the main theme config\n                if [ -f "$THEME_CONFIG" ]; then\n                    sudo sed -i 's|Background=.*|Background="background.jpg"|g' "$THEME_CONFIG" 2>/dev/null || true\n                fi\n                echo -e "  ${GREEN}[OK] SDDM static wallpaper set${NC}"\n            fi\n            \n            # Copy fonts for the theme\n            if [ -d "/usr/share/sddm/themes/sddm-astronaut-theme/Fonts" ]; then\n                echo -e "  ${GREEN}[*] Installing SDDM theme fonts...${NC}"\n                sudo cp -r /usr/share/sddm/themes/sddm-astronaut-theme/Fonts/* /usr/share/fonts/ 2>/dev/null || true\n                sudo fc-cache -fv 2>/dev/null || true\n            fi\n        fi\n    else\n        echo -e "  ${GREEN}[WARN] No wallpaper available, hyprpaper will use default${NC}"\n    fi\nfi\n\n# Fix permissions\necho -e "${GREEN}[*] Fixing permissions...${NC}"\nsudo chown -R "$USER:$USER" "$HOME" 2>/dev/null || true\nsudo chmod 755 "$HOME" 2>/dev/null || true\n\n# Verify Hyprland binary\nif [ -x "/usr/bin/Hyprland" ]; then\n    echo -e "  ${GREEN}[OK] Hyprland binary found${NC}"\nelse\n    echo -e "  ${GREEN}[WARN] Hyprland binary not found at /usr/bin/Hyprland${NC}"\n    HYPRLAND_PATH=$(which Hyprland 2>/dev/null || find /usr -name "Hyprland" -type f 2>/dev/null | head -n1)\n    if [ -n "$HYPRLAND_PATH" ]; then\n        sudo ln -sf "$HYPRLAND_PATH" /usr/bin/Hyprland 2>/dev/null || true\n    fi\nfi\n\n# Final summary\necho -e "${GREEN}[*] Display Manager configured${NC}"\necho -e "  ${GREEN}[OK] SDDM will provide graphical login screen${NC}"\necho -e "  ${GREEN}[OK] SDDM supports VIDEO wallpapers (astronaut theme)!${NC}"\necho -e "  ${GREEN}[OK] Hyprland is the default session${NC}"\necho -e "  ${GREEN}[OK] hyprlock works for locking (SUPER+L)${NC}"\necho -e "  ${GREEN}[OK] Video lock screen: SUPER+SHIFT+L (requires mpvpaper)${NC}"\necho -e "  ${GREEN}[OK] Live wallpaper: SUPER+F10 (start), SUPER+SHIFT+F10 (stop)${NC}"\n\necho ""\necho -e "${GREEN}========================================${NC}"\necho -e "${GREEN}     Installation Complete!${NC}"\necho -e "${GREEN}     Mode: ${MODE}${NC}"\necho -e "${GREEN}========================================${NC}"\necho ""\n\nif [ "$MODE" != "minimal" ] && [ -n "$backup_dir" ]; then\n    echo -e "${GREEN}Backup saved to: $backup_dir${NC}"\n    echo ""\nfi\n\necho -e "${GREEN}IMPORTANT FIXES APPLIED:${NC}"\necho -e "  - SDDM now uses X11 backend (more stable)"\necho -e "  - SDDM Astronaut theme with VIDEO support installed"\necho -e "  - NVIDIA environment variables set"\necho -e "  - Display rendering fixes applied"\necho ""\necho -e "${GREEN}If SDDM theme didn't change:${NC}"\necho -e "  Run: sudo systemctl restart sddm"\necho -e "  Or reboot: sudo reboot"\necho -e "  Test theme: sddm-greeter-qt6 --test-mode --theme /usr/share/sddm/themes/sddm-astronaut-theme/"\necho ""\necho -e "${GREEN}If you still get login loop:${NC}"\necho -e "  1. At SDDM, press Ctrl+Alt+F2"\necho -e "  2. Login and run: Hyprland"\necho -e "  3. Check error message"\necho ""\n\n# Ask for reboot\necho -e "${GREEN}Do you want to reboot now? (y/N): ${NC}"\nread -r reboot_choice\nif [[ "$reboot_choice" =~ ^[Yy]$ ]]; then\n    echo -e "${GREEN}Rebooting...${NC}"\n    sudo reboot\nelse\n    echo -e "${GREEN}Reboot skipped. Run 'sudo reboot' when ready.${NC}"\nfi\n